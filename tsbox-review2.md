tsbox review 2
================
nunesmatt
19/01/2023

The full script of this review can be found at my github page
[here](https://github.com/nunesmatt/tsbox-review/tsbox-review2.md).

## Package Review

*Please check off boxes as applicable, and elaborate in comments below.
Your review is not limited to these topics, as described in the reviewer
guide*

  - **Briefly describe any working relationship you have (had) with the
    package authors.**
  - [x] As the reviewer I confirm that there are no [conflicts of
    interest](https://devguide.ropensci.org/policies.html#coi) for me to
    review this work (if you are unsure whether you are in conflict,
    please speak to your editor *before* starting your review).

#### Documentation

The package includes all the following forms of documentation:

  - [x] **A statement of need:** clearly stating problems the software
    is designed to solve and its target audience in README
  - [x] **Installation instructions:** for the development version of
    package and any non-standard dependencies in README
  - [x] **Vignette(s):** demonstrating major functionality that runs
    successfully locally
  - [x] **Function Documentation:** for all exported functions
  - [x] **Examples:** (that run successfully locally) for all exported
    functions
  - [x] **Community guidelines:** including contribution guidelines in
    the README or CONTRIBUTING, and DESCRIPTION with `URL`, `BugReports`
    and `Maintainer` (which may be autogenerated via `Authors@R`).

#### Functionality

  - [x] **Installation:** Installation succeeds as documented.

  - [x] **Functionality:** Any functional claims of the software been
    confirmed.

  - [x] **Performance:** Any performance claims of the software been
    confirmed.

  - [x] **Automated tests:** Unit tests cover essential functions of the
    package and a reasonable range of inputs and conditions. All tests
    pass on the local machine.

  - [x] **Packaging guidelines**: The package conforms to the rOpenSci
    packaging guidelines. Estimated hours spent reviewing: 7

  - [x] Should the author(s) deem it appropriate, I agree to be
    acknowledged as a package reviewer (“rev” role) in the package
    DESCRIPTION file.

-----

### Review Comments

**Summary**

The package is a comprehensive conversion tool for all current time
series objects, stemming from the desire to be structure/class-agnostic.
As outlined in my first review, I feel this is a useful package in terms
of functionality and scope for the R community. The associated package
vignettes and other documentation are well set out. Readdressing the
comments from my first review:

Some comments on the package are below. Note that these are suggestions
rather than fixes per se:

1.  **Package checking**. When checking the package, I get:

<!-- end list -->

    dts_first_of_period: no visible binding for global variable ‘time.orig’
    ## Undefined global functions or variables:
    ##   time.orig

**This has been fixed successfully**.

2.  **good practice**. A few things came up when using `gp`. Many code
    lines come up as 81 characters (as opposed to suggested lengths of
    ![\\leq 80](https://latex.codecogs.com/png.image?%5Cdpi%7B110%7D&space;%5Cbg_white&space;%5Cleq%2080
    "\\leq 80")), which might be due to line endings etc. `guess_dts.R`
    has a suggestion of using `vapply` rather than `sapply`. These are
    left to the developer to tackle if desired.

@christophsax : You are right that these are SRR stats related, and as
such I am fine with them being left as is.

3.  **Error message about `ts_boxable(x)`**. I wonder whether a more
    informative error message could be shown when `ts_boxable(x)` is not
    `TRUE`.

**This new error message is now more helpful to the beginner user**.

4.  The package developer might want to consider an additional function
    handling the `zooreg` class for completeness.

@christophsax : thanks for the inclusion.

5.  Whilst users are probably familiar with usage, the developer might
    want to consider adding examples to show functionality of
    `ts_prcomp` and `ts_forecast` under the `ts_examples` documentation
    file.

On reflection, including examples within `ts_plot` might indeed be
overkill, and I suggest leaving the documentation as is.

6.  I noticed that there is a spelling mistake of *explicit* in the
    error messages for the `guess_time` and `guess_value` functions.

\*\* this has been fixed successfully \*\*.

Having run through various checks on the package, in summary
@christophsax has addressed all my comments and has a great package for
end-users.

<br><br><br>

``` r
# some setup
library(devtools)
```

    ## Loading required package: usethis

``` r
install_github("christophsax/tsbox", force = TRUE)
```

    ## Downloading GitHub repo christophsax/tsbox@HEAD

    ## 
    ## * checking for file ‘/tmp/RtmpRfIN0y/remotesc5917a8cadac/christophsax-tsbox-f651fc7/DESCRIPTION’ ... OK
    ## * preparing ‘tsbox’:
    ## * checking DESCRIPTION meta-information ... OK
    ## * checking for LF line-endings in source and make files and shell scripts
    ## * checking for empty or unneeded directories
    ## * looking to see if a ‘data/datalist’ file should be added
    ## * building ‘tsbox_0.3.1.9005.tar.gz’

    ## Installing package into '/home/matt/myrlibrary'
    ## (as 'lib' is unspecified)

``` r
library(tsbox)

# create local version too
library(gert)
```

    ## Linking to libgit2 v1.4.2, ssh support: YES

    ## Global config: /home/matt/.gitconfig

    ## Default user: Matt Nunes <matt.nunes@gmail.com>

``` r
gert::git_clone("https://github.com/christophsax/tsbox", path = "./tsbox-temp")

sessionInfo()
```

    ## R version 4.1.3 (2022-03-10)
    ## Platform: x86_64-pc-linux-gnu (64-bit)
    ## Running under: Ubuntu 20.04.5 LTS
    ## 
    ## Matrix products: default
    ## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3
    ## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3
    ## 
    ## locale:
    ##  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C               LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
    ##  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8    LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
    ##  [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       
    ## 
    ## attached base packages:
    ## [1] stats     graphics  grDevices utils     datasets  methods   base     
    ## 
    ## other attached packages:
    ## [1] gert_1.9.0       tsbox_0.3.1.9005 devtools_2.4.4   usethis_2.1.6   
    ## 
    ## loaded via a namespace (and not attached):
    ##  [1] Rcpp_1.0.9        urlchecker_1.0.1  compiler_4.1.3    later_1.3.0       sys_3.4           remotes_2.4.2    
    ##  [7] prettyunits_1.1.1 profvis_0.3.7     tools_4.1.3       digest_0.6.29     pkgbuild_1.3.1    pkgload_1.3.0    
    ## [13] anytime_0.3.9     evaluate_0.16     memoise_2.0.1     lifecycle_1.0.2   rlang_1.0.6       shiny_1.7.2      
    ## [19] cli_3.4.1         rstudioapi_0.14   curl_4.3.3        yaml_2.3.5        xfun_0.33         fastmap_1.1.0    
    ## [25] withr_2.5.0       stringr_1.4.1     knitr_1.40        askpass_1.1       fs_1.5.2          htmlwidgets_1.5.4
    ## [31] rprojroot_2.0.3   data.table_1.14.6 glue_1.6.2        R6_2.5.1          processx_3.7.0    rmarkdown_2.16   
    ## [37] sessioninfo_1.2.2 purrr_0.3.4       callr_3.7.2       magrittr_2.0.3    credentials_1.3.2 promises_1.2.0.1 
    ## [43] ps_1.7.1          ellipsis_0.3.2    htmltools_0.5.3   mime_0.12         xtable_1.8-4      httpuv_1.6.6     
    ## [49] stringi_1.7.8     miniUI_0.1.1.1    openssl_2.0.3     cachem_1.0.6      crayon_1.5.1

``` r
library(devtools)
devtools::check("./tsbox-temp")
```

    ## ══ Documenting ═════════════════════════════════════════════════════════════════════════════════════════════════════════

    ## ℹ Installed roxygen2 version (7.2.1) doesn't match required (7.2.3)
    ## ✖ `check()` will not re-document this package

    ## ══ Building ════════════════════════════════════════════════════════════════════════════════════════════════════════════
    ## Setting env vars:
    ## • CFLAGS    : -Wall -pedantic
    ## • CXXFLAGS  : -Wall -pedantic
    ## • CXX11FLAGS: -Wall -pedantic
    ## • CXX14FLAGS: -Wall -pedantic
    ## • CXX17FLAGS: -Wall -pedantic
    ## • CXX20FLAGS: -Wall -pedantic
    ## * checking for file ‘/home/matt/Dropbox/ReviewsAndOther/ROpenSci/tsbox/tsbox-review/tsbox-temp/DESCRIPTION’ ... OK
    ## * preparing ‘tsbox’:
    ## * checking DESCRIPTION meta-information ... OK
    ## * installing the package to build vignettes
    ## * creating vignettes ... OK
    ## * checking for LF line-endings in source and make files and shell scripts
    ## * checking for empty or unneeded directories
    ## * looking to see if a ‘data/datalist’ file should be added
    ## * building ‘tsbox_0.3.1.9005.tar.gz’
    ## 
    ## ══ Checking ════════════════════════════════════════════════════════════════════════════════════════════════════════════
    ## Setting env vars:
    ## • _R_CHECK_CRAN_INCOMING_USE_ASPELL_: TRUE
    ## • _R_CHECK_CRAN_INCOMING_REMOTE_    : FALSE
    ## • _R_CHECK_CRAN_INCOMING_           : FALSE
    ## • _R_CHECK_FORCE_SUGGESTS_          : FALSE
    ## • NOT_CRAN                          : true
    ## ── R CMD check ─────────────────────────────────────────────────────────────────────────────────────────────────────────
    ## * using log directory ‘/tmp/RtmpRfIN0y/tsbox.Rcheck’
    ## * using R version 4.1.3 (2022-03-10)
    ## * using platform: x86_64-pc-linux-gnu (64-bit)
    ## * using session charset: UTF-8
    ## * using options ‘--no-manual --as-cran’
    ## * checking for file ‘tsbox/DESCRIPTION’ ... OK
    ## * checking extension type ... Package
    ## * this is package ‘tsbox’ version ‘0.3.1.9005’
    ## * package encoding: UTF-8
    ## * checking package namespace information ... OK
    ## * checking package dependencies ... OK
    ## * checking if this is a source package ... OK
    ## * checking if there is a namespace ... OK
    ## * checking for executable files ... OK
    ## * checking for hidden files and directories ... OK
    ## * checking for portable file names ... OK
    ## * checking for sufficient/correct file permissions ... OK
    ## * checking serialization versions ... OK
    ## * checking whether package ‘tsbox’ can be installed ... OK
    ## * checking installed package size ... OK
    ## * checking package directory ... OK
    ## * checking for future file timestamps ... OK
    ## * checking ‘build’ directory ... OK
    ## * checking DESCRIPTION meta-information ... OK
    ## * checking top-level files ... OK
    ## * checking for left-over files ... OK
    ## * checking index information ... OK
    ## * checking package subdirectories ... OK
    ## * checking R files for non-ASCII characters ... OK
    ## * checking R files for syntax errors ... OK
    ## * checking whether the package can be loaded ... OK
    ## * checking whether the package can be loaded with stated dependencies ... OK
    ## * checking whether the package can be unloaded cleanly ... OK
    ## * checking whether the namespace can be loaded with stated dependencies ... OK
    ## * checking whether the namespace can be unloaded cleanly ... OK
    ## * checking loading without being on the library search path ... OK
    ## * checking dependencies in R code ... OK
    ## * checking S3 generic/method consistency ... OK
    ## * checking replacement functions ... OK
    ## * checking foreign function calls ... OK
    ## * checking R code for possible problems ... OK
    ## * checking Rd files ... OK
    ## * checking Rd metadata ... OK
    ## * checking Rd line widths ... OK
    ## * checking Rd cross-references ... OK
    ## * checking for missing documentation entries ... OK
    ## * checking for code/documentation mismatches ... OK
    ## * checking Rd \usage sections ... OK
    ## * checking Rd contents ... OK
    ## * checking for unstated dependencies in examples ... OK
    ## * checking R/sysdata.rda ... OK
    ## * checking installed files from ‘inst/doc’ ... OK
    ## * checking files in ‘vignettes’ ... OK
    ## * checking examples ... OK
    ## * checking examples with --run-donttest ... OK
    ## * checking for unstated dependencies in ‘tests’ ... OK
    ## * checking tests ...
    ##   Running ‘spelling.R’
    ##   Comparing ‘spelling.Rout’ to ‘spelling.Rout.save’ ...9,15d8
    ## < Potential spelling errors:
    ## <   WORD        FOUND IN
    ## < POSIXct     NEWS.md:23
    ## < stopifnot   NEWS.md:24
    ## < timetk      tsbox.Rmd:346
    ## < zooreg      NEWS.md:5
    ## <             README.md:44
    ##   Running ‘testthat.R’ [69s/23s]
    ##  OK
    ## * checking for unstated dependencies in vignettes ... OK
    ## * checking package vignettes in ‘inst/doc’ ... OK
    ## * checking re-building of vignette outputs ... OK
    ## * checking for non-standard things in the check directory ... OK
    ## * checking for detritus in the temp directory ... OK
    ## * DONE
    ## 
    ## Status: OK

    ## ── R CMD check results ─────────────────────────────────────────────────────────────────────────── tsbox 0.3.1.9005 ────
    ## Duration: 1m 0.3s
    ## 
    ## 0 errors ✔ | 0 warnings ✔ | 0 notes ✔

rechecking the error from idiot-proofing:

``` r
# messages for idiot-proofing

# create *vector* rather than ts
mynonts = sin((1:256)/pi) + rnorm(256) 

try(ts_xts(mynonts))
```

    ## Error : object is of non-ts-boxable class(es) 'numeric'. See `?ts_ts`.

``` r
## check on daisy-chaining with zoo:
library(astsa)
data(AirPassengers)
ts_plot(ts_zooreg(ts_xts(AirPassengers)))
```

    ## Loading required namespace: xts

![](tsbox-review2_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

### something else minor

``` r
try(tsbox:::guess_time(as.data.frame(x=runif(10))))
```

    ## Error : no [time] column detected; to be explicit, name time column as 'time'

``` r
try(tsbox:::guess_value(as.data.frame(x=LETTERS[1:10])))
```

    ## Error : no [value] column detected; to be explicit, name value column as 'value'
